<html>
<head></head>
<body>
<div id="books_field"></div>
</body>
<script>
	const rowTree = '{"tree":[{"type":"file","id":"div1", "name" : "Book1"},{"type":"folder","id":"div2", "name" : "folder1", "children":[{"type":"file","id":"div3", "name" : "Book2"}]}]}'
	const treeObject = JSON.parse(rowTree);
    const books_field = document.getElementById("books_field");

    console.log(treeObject);

    for (const tree of treeObject["tree"]) {
        if(isFile(tree["type"])) {
            books_field.appendChild(createBookElement(tree["id"], tree["name"], ["div_content", "file_content"]));
		} else {
            const content = createBookElement(tree["id"], tree["name"], ["div_content"])
            books_field.appendChild(content);

            for (const child of tree["children"]) {
                const classes = isFile(child["type"]) ? ["div_content", "file_content"] : ["div_content"];
                content.appendChild(createBookElement(child["id"], child["name"], classes));
			}
		}
	}

    // ドラッグ&ドロップの設定
	for (const item of document.querySelectorAll('.div_content')) {
        item.addEventListener('dragstart', (event) => {
            event.dataTransfer.setData('text/plain', event.target.id);
        })

        item.addEventListener('dragover', (event) => {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy';
        })

        item.addEventListener('drop', (event) => {
            event.preventDefault();
			const itemId = event.dataTransfer.items ? event.dataTransfer.getData(event.dataTransfer.items[0]["type"]) : "";

            if (itemId !== '') {
                event.target.appendChild(document.getElementById(itemId));
            }
        })
    }

    function createBookElement(own_id, text, classes) {
        const bookElement = document.createElement('div');
        bookElement.id = own_id;
        bookElement.textContent = text;
        bookElement.setAttribute("draggable", true);

        for (const applyClass of classes) {
            bookElement.classList.add(applyClass);
		}

        return bookElement;
	}

    function isFile(type) {
        return type === "file";
	}

    // 木構造の中での移動
    function moveItem(own_id, parent_id) {
        // 自身のidに対応する構造体を探す

		// 親になるidに対応する構造体を探す
	}

    // 木構造から該当のleafを探す
    function searchIdFromTree(id) {
        for (const top of treeObject["tree"]) {
            for (const child of top["children"]) {
                for (const grandChild of child["children"]) {
                    if (grandChild["id"] === id) {
                        return grandChild;
					}
				}
			}
		}
	}

</script>
<style>
    .div_content { background-color: red; }
    .div_content { height: 20%; }
    .div_content { margin: 5%; }
    .div_content { width: 30%; }

    .file_content { background-color: blue}
</style>
</html>